# Python 文档字符串（Docstring）编写指南

本文档提供了如何为Python函数、类和模块编写详细、规范的文档字符串的指南，以提高代码可读性和可维护性。

## 1. 文档字符串的重要性

- **提高可读性**：帮助其他开发者快速理解代码功能
- **辅助维护**：减少维护代码的时间和成本
- **自动生成文档**：可用于生成API文档
- **运行时帮助**：可通过`help()`函数访问
- **IDE支持**：提供代码补全和提示

## 2. 文档字符串格式

本项目推荐使用**NumPy/SciPy风格**的文档字符串，它非常适合科学计算和复杂函数。

### 2.1 函数文档字符串模板

```python
def function_name(param1, param2, optional_param=None):
    """
    简短描述：一行总结函数的主要功能
    
    详细描述：更详细地解释函数的工作原理、用途和应用场景。
    可以包含多个段落，以提供全面的理解。
    
    参数
    ----
    param1 : 类型
        参数param1的详细说明
    param2 : 类型
        参数param2的详细说明
    optional_param : 类型, 可选
        可选参数的详细说明，包括默认值的含义
    
    返回值
    ------
    返回类型
        返回值的详细说明，如果函数有多种返回情况，分别解释
    
    示例
    ----
    >>> function_name(1, 2)
    输出结果的示例
    
    注意
    ----
    任何需要特别注意的事项，如性能考虑、特殊情况等
    
    警告
    ----
    潜在的风险或副作用
    """
    # 函数实现...
```

### 2.2 类文档字符串模板

```python
class ClassName:
    """
    类的简短描述：一行总结类的主要用途
    
    详细描述：解释类的设计目的、工作原理和使用场景。
    
    属性
    ----
    attribute1 : 类型
        属性attribute1的详细说明
    attribute2 : 类型
        属性attribute2的详细说明
    
    方法
    ----
    method1()
        方法method1的简短描述
    method2()
        方法method2的简短描述
    
    示例
    ----
    >>> instance = ClassName()
    >>> instance.method1()
    输出结果的示例
    """
    # 类实现...
```

## 3. 实际示例

以下是从我们项目中修改的一个实际例子：

### 3.1 复杂函数的详细文档字符串

```python
def get_version(self) -> None:
    """
    计算并设置电池分析的版本号
    
    此方法通过分析输入目录中的XLSX文件，计算其MD5校验和，
    然后根据MD5.csv文件中的历史记录确定当前版本号。如果输入文件内容变更，
    版本号会自动增加。
    
    工作流程
    --------
    1. 从UI获取输入和输出目录路径
    2. 检查目录是否存在
    3. 收集输入目录中所有有效的.xlsx文件（排除临时文件）
    4. 计算这些文件的MD5校验和
    5. 读取MD5.csv文件（如果存在）来获取历史记录
    6. 根据MD5校验和匹配确定版本号
    7. 如果找到匹配的MD5，使用对应的版本号；否则创建新版本
    8. 更新MD5.csv文件并设置为隐藏属性
    9. 将版本号显示在UI中
    
    版本号格式
    ----------
    - 主版本号：当输入文件内容发生变化时增加
    - 次版本号：同一内容的重复运行计数
    
    错误处理
    --------
    - 如果输入或输出目录不存在，清空版本号显示
    - 如果输入目录中没有XLSX文件，清空版本号显示
    
    返回值
    ------
    None
    """
    # 函数实现...
```

## 4. 常见文档字符串部分说明

### 4.1 参数（Parameters）

详细列出每个参数的名称、类型、默认值和说明。对于复杂参数，可以解释其预期格式或取值范围。

### 4.2 返回值（Returns）

清晰说明函数的返回类型和含义。如果函数可能返回不同类型的值，分别说明每种情况。

### 4.3 异常（Raises）

列出函数可能抛出的异常及其触发条件。

```python
"""
异常
----
ValueError
    当输入参数格式不正确时抛出
FileNotFoundError
    当指定的文件不存在时抛出
"""
```

### 4.4 示例（Examples）

提供函数的使用示例，包括输入和预期输出。这对于理解函数的实际用途非常有帮助。

### 4.5 注意事项（Notes/Warnings）

记录任何需要用户注意的特殊情况、性能考虑或潜在风险。

## 5. 特殊情况处理

### 5.1 私有函数

即使是私有函数（以单下划线或双下划线开头），也应该有简洁的文档字符串，说明其用途和工作原理。

### 5.2 简单函数

对于简单的辅助函数，可以使用简化的文档字符串格式，但仍应包含基本信息。

```python
def helper_function(param):
    """
    简短描述param的处理过程。
    
    参数
    ----
    param : 类型
        参数说明
    
    返回
    ----
    类型
        返回值说明
    """
    # 实现
```

## 6. 工具和自动化

### 6.1 文档生成工具

- **Sphinx**：可以从文档字符串生成HTML/PDF文档
- **pydoc**：Python内置的文档生成工具
- **autodoc**：Sphinx的扩展，可以自动从文档字符串生成API文档

### 6.2 文档字符串检查工具

- **pydocstyle**：检查文档字符串是否符合PEP 257规范
- **darglint**：检查文档字符串中的参数和返回值描述是否与函数签名匹配

## 7. 最佳实践

1. **保持文档更新**：代码变更时，同步更新文档字符串
2. **使用一致的格式**：在整个项目中使用统一的文档字符串风格
3. **避免过度冗余**：文档应该简洁明了，避免简单重复代码逻辑
4. **关注用户视角**：从使用者的角度编写文档，说明如何正确使用函数
5. **包含边界情况**：说明函数在特殊输入下的行为
6. **使用正确的语法**：遵循所选文档字符串风格的语法规则

## 8. 为现有复杂函数添加文档的步骤

1. **分析函数**：理解函数的目的、参数、返回值和工作流程
2. **提取关键信息**：识别重要的参数、返回类型和可能的异常
3. **编写结构**：按照模板创建文档字符串框架
4. **填充内容**：详细描述每个部分
5. **添加示例**：提供实际使用场景
6. **审查和完善**：确保文档准确反映代码行为

通过遵循这些指南，您可以创建清晰、有用的文档字符串，大大提高代码的可读性和可维护性。