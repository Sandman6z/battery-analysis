name: Sync to Wiki

on:
  push:
    branches: [main, "feat/*"]

jobs:
  sync-wiki:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    env:
      PYTHONIOENCODING: utf-8
      PYTHONUTF8: 1
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Wiki initialization Check
        run: |
          # 检查Wiki是否已初始化
          echo "Checking if Wiki is initialized..."
          
          # 直接检查wiki.git仓库是否存在
          WIKI_URL="https://github.com/${{ github.repository }}.wiki.git"
          echo "Checking Wiki repository at: $WIKI_URL"
          
          # 使用git ls-remote检查仓库是否存在
          if git ls-remote --exit-code "$WIKI_URL" > /dev/null 2>&1; then
            echo "✓ Wiki repository exists and is accessible"
          else
            echo "✗ Wiki repository not found or inaccessible"
            echo "Please manually initialize Wiki in GitHub settings:"
            echo "1. Go to GitHub repository > Settings > Features > Wiki"
            echo "2. Enable Wiki feature"
            echo "3. Create at least one Wiki page to initialize the repository"
            exit 0
          fi

      - name: Sync Markdown to Wiki
        uses: Andrew-Chen-Wang/github-wiki-action@v3
        with:
          WIKI_DIR: "docs"
          WIKI_PUSH_MESSAGE: "docs: update wiki from docs directory"
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
          GH_NAME: "Sandman6z"
          GH_MAIL: "zbnsandman@gmail.com"
          REPO: ${{ github.repository }}