name: Sync to Gitee

on:
  push:
    branches: [ main ]
  release:
    types: [ published, created, edited, prereleased ]

jobs:
  # 代码同步任务
  sync-repo:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Sync to Gitee
        uses: wearerequired/git-mirror-action@v1
        env:
          # 注意: 在GitHub仓库的Settings > Secrets中添加GITEE_TOKEN
          SSH_PRIVATE_KEY: ${{ secrets.GITEE_SSH_PRIVATE_KEY }}
        with:
          # 源仓库地址
          source-repo: "git@github.com:${{ github.repository }}.git"
          # 目标仓库地址
          destination-repo: "git@gitee.com:boedt/battery-analysis.git"
      
      # 如果使用HTTPS方式，也可以使用这个Action
      # - name: Sync to Gitee
      #   uses: Yikun/hub-mirror-action@master
      #   with:
      #     src: github/${{ github.repository }}
      #     dst: gitee/boedt/battery-analysis
      #     dst_key: ${{ secrets.GITEE_SSH_PRIVATE_KEY }}
      #     dst_token: ${{ secrets.GITEE_TOKEN }}
      #     static_list: "battery-analysis"
      #     debug: true

  # Release同步任务
  sync-release:
    if: github.event_name == 'release'
    needs: sync-repo
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Sync Release to Gitee
        uses: yanglbme/gitee-repos-sync@v1
        with:
          # GitHub配置
          github-token: ${{ secrets.GITHUB_TOKEN }}
          github-repo: ${{ github.repository }}
          
          # Gitee配置
          gitee-username: boedt
          gitee-password: ${{ secrets.GITEE_PASSWORD }}
          gitee-token: ${{ secrets.GITEE_TOKEN }}
          gitee-repo: battery-analysis
          
          # Release配置
          sync-tags: true
          sync-releases: true
          sync-releases-asset: true
          
          # 调试选项
          debug: true